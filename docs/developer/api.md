# API Документация Telegram-бота Дневника Самонаблюдения

## Общая информация

Этот Telegram-бот позволяет пользователю вести дневник самонаблюдения и отслеживать приёмы пищи. Взаимодействие происходит через кнопки и сообщения. Состояния отслеживаются с помощью конечного автомата состояний (FSM).

---

## Состояния FSM

| Состояние                      | Описание                                     |
|-------------------------------|----------------------------------------------|
| STATE_NONE                    | Начальное/финальное состояние                |
| STATE_WRITING_SITUATION       | Ввод описания ситуации                       |
| STATE_WRITING_THOUGHTS        | Ввод мыслей                                  |
| STATE_WRITING_EMOTIONS        | Выбор эмоций из кнопочной клавиатуры         |
| STATE_WRITING_SENSATIONS      | Ввод телесных ощущений                       |
| STATE_WRITING_ACTIONS         | Ввод действий                                |
| STATE_WRITING_DESIRES         | Ввод желаний                                 |
| STATE_WRITING_MEALS_COUNT     | Ввод количества приемов пищи                 |
| STATE_WRITING_MEALS_COMMENT   | Ввод комментариев к питанию                  |
| STATE_SELECTING_REPORT_DATE   | Ввод даты для генерации отчёта               |

---

## Команды бота

| Команда     | Описание                              |
|-------------|---------------------------------------|
| `/start`    | Запуск бота и показ главного меню     |
| `/help`     | Показывает справочную информацию      |
| `/cancel`   | Отменяет текущее действие             |
| `/reset`    | Сброс состояния пользователя          |

---

## Кнопки в главном меню

| Текст кнопки        | Callback data      | Действие                                           |
|---------------------|--------------------|----------------------------------------------------|
| 📝 Запись в дневник | `journal_entry`    | Начать запись дневника                             |
| 🍎 Питание           | `meals_entry`      | Записать количество приёмов пищи и комментарий     |
| 📊 Отчёт за день     | `daily_report`     | Запрос отчета за выбранную дату                    |
| ℹ️ Помощь            | `help`             | Показать справку                                   |

---

## Формат данных

### Journal Entry

```json
{
  "user_id": 123456789,
  "date": "2025-05-28",
  "situation": "описание",
  "thoughts": "мысли",
  "emotions": "радость, вдохновение",
  "sensations": "ощущения",
  "actions": "действия",
  "desires": "желания"
}
```

# ⚙️ Основные компоненты

## 1. FSM: Управление состояниями
Состояния (`state`) отслеживаются через `context.user_data['state']`.  
Переходы между состояниями осуществляются в зависимости от ввода пользователя и callback-ответов.

## 2. Обработчики

| Хендлер                       | Назначение                                |
|------------------------------|--------------------------------------------|
| `start()`                    | Приветствие и показ главного меню          |
| `button_handler()`           | Обработка inline-кнопок                    |
| `handle_journal_entry()`     | FSM-ввод для дневника                      |
| `handle_meals_entry()`       | FSM-ввод для питания                       |
| `handle_report_date_selection()` | Обработка ввода даты                  |
| `send_daily_report()`        | Генерация и отправка отчёта пользователю   |
| `cancel()`                   | Отмена действий и очистка состояния        |
| `reset()`                    | Принудительный сброс состояния пользователя|

---

# 🛢️ Работа с базой данных

Используется **SQLite**. Таблицы:

- `journal_entries` — записи дневника  
- `meal_entries` — записи питания

```sql
CREATE TABLE journal_entries (
  id INTEGER PRIMARY KEY,
  user_id INTEGER,
  date TEXT,
  situation TEXT,
  thoughts TEXT,
  emotions TEXT,
  sensations TEXT,
  actions TEXT,
  desires TEXT
);

CREATE TABLE meal_entries (
  id INTEGER PRIMARY KEY,
  user_id INTEGER,
  date TEXT,
  meals_count INTEGER,
  comments TEXT
);
```

# 📱 Пользовательский интерфейс
Используются `InlineKeyboardMarkup` с кнопками:

- Главное меню 
- Выбор эмоций (группировка и множественный выбор)
- Отчёт по датам
- 
# ✅ Особенности реализации
- Поддержка повторного ввода и валидация данных (например, проверка даты)
- Использование `context.user_data` для сохранения промежуточных данных 
- Отчётный механизм по выбранной дате

# 🔧 Возможные улучшения
- Хранение пользователей и профилей 
- Расширение отчётов (графики, анализ)
- Мультипользовательская панель администратора 
- Поддержка мультиязычности 
- Экспорт данных

# 📌 Зависимости
`python-telegram-bot >= 20.x`
`sqlite3`
`logging`
